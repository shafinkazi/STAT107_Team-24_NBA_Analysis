null_model <- glm(win_binary ~ 1, data = team_game, family = binomial)
anova(null_model, logit_model, test = "Chisq")
#2. Hosmer–Lemeshow Test (requires ResourceSelection package)
hoslem.test(team_game$win_binary, fitted(logit_model), g = 10)
#3. Pseudo R-squared values (McFadden, Cox & Snell, Nagelkerke)
pR2(logit_model)
#5. ROC Curve and AUC
roc_obj <- roc(team_game$win_binary, pred_prob)
knitr::opts_chunk$set(echo = TRUE)
source("00_requirements.R")
search()
#Data Cleaning
raw_database_24_25 <- read_csv("database_24_25.csv")
head(raw_database_24_25)
# TEAM-GAME
team_game <- raw_database_24_25 %>%
group_by(Data, Tm, Opp, Res) %>%
summarise(
FG = sum(FG, na.rm = TRUE),
FGA = sum(FGA, na.rm = TRUE),
FG_pct = FG / FGA,
`3P` = sum(`3P`, na.rm = TRUE),
`3PA` = sum(`3PA`, na.rm = TRUE),
`3P_pct` = `3P` / `3PA`,
FT = sum(FT, na.rm = TRUE),
STL = sum(STL, na.rm = TRUE),
BLK = sum(BLK, na.rm = TRUE),
defensive_pressure = STL + BLK,
points = sum(PTS, na.rm = TRUE)
) %>%
ungroup()
head(team_game)
# TEAM-SEASON
team_season <- team_game %>%
group_by(Tm) %>%
summarise(
wins = sum(Res == "W"),
losses = sum(Res == "L"),
avg_FG_pct = mean(FG_pct, na.rm = TRUE),
avg_3P_pct = mean(`3P_pct`, na.rm = TRUE),
total_ft = sum(FT, na.rm = TRUE),
total_stl = sum(STL, na.rm = TRUE),
total_blk = sum(BLK, na.rm = TRUE),
avg_def_pressure = mean(defensive_pressure, na.rm = TRUE),
.groups = "drop"
)
team_season <- team_season %>% # order by who has the most wins
arrange(desc(wins))
head(team_season)
#Offensive Statistics
# Histogram: Field Goal Percentage (FG%)
ggplot(team_game, aes(x = FG_pct)) +
geom_histogram(bins = 30, fill = "skyblue", color = "black") +
labs(
title = "Distribution of Team Field Goal Percentage",
x = "Field Goal Percentage",
y = "Frequency"
) +
theme_minimal()
# Boxplot: Three-Point Percentage (3P%)
ggplot(team_game, aes(y = `3P_pct`)) +
geom_boxplot(fill = "skyblue", color = "black") +
labs(
title = "Boxplot of Team Three-Point Percentage",
y = "Three-Point Percentage"
) +
theme_minimal()
# Scatter Plot: Total Points Scored by Game
ggplot(team_game, aes(x = 1:nrow(team_game), y = points)) +
geom_point(color = "lightgreen", alpha = 0.7) +
labs(
title = "Total Points Scored by Game",
x = "Game Number",
y = "Points Scored"
) +
theme_minimal()
#Defensive Statistics
# Histogram: Total Steals Per Game
ggplot( team_game, aes(x = STL)) +
geom_histogram(bins = 30, fill = "purple", color = "black" ) +
labs(
title = "Distribution of Team Steals Per Game",
x = "Steals",
y = "Frequency"
) +
theme_minimal()
# Boxplot of Blocks by Game Outcome
ggplot(team_game, aes(x = Res, y = BLK, fill = Res)) +
geom_boxplot() +
labs(
title = "Blocks Per Game by Game Outcome",
x = "Game Result",
y = "Blocks"
) +
scale_fill_manual(values = c("W" = "lightblue", "L" = "salmon")) +
theme_minimal()
# Scatter Plot: Defensive Pressure by Game
ggplot(team_game, aes(x = 1:nrow(team_game), y = defensive_pressure)) +
geom_point(color = "lightcoral", alpha = 0.7) +
labs(
title = "Defensive Pressure (Steals + Blocks) by Game — 2024–25 NBA Season",
x = "Game Number",
y = "Defensive Pressure (STL + BLK)"
) +
theme_minimal()
# 3-Point Percentage (Offensive Efficiency)
# H0:There is no difference in the average 3-point shooting percentage (3P%) between games that teams win and games that teams lose.
# Ha: There is a difference in the average 3-point shooting percentage (3P%) between games that teams win and games that teams lose.
t_test_3p <- t.test(`3P_pct` ~ Res , data = team_game)
t_test_3p
# Defensive Pressure (Steals + Blocks)
# H0: There is no difference in the average defensive pressure (steals + blocks) between games that teams win and games that teams lose.
# Ha: There is a difference in the average defensive pressure (steals + blocks) between games that teams win and games that teams lose.
t_test_def <- t.test(defensive_pressure ~ Res, data = team_game)
t_test_def
set.seed(800) # keep clustering consistent
head(team_season)
# Create model to see which of the variables are most significant
# Notes on the model:
# R^2 with all 5: 0.6003
# R^2 after removing:
# avg_3P_pct 0.5732
# avg_FG_pct 0.4993 *
# total_ft 0.5986
# total_stl 0.4749 *
# total_blocks 0.5762
season_model <- lm(wins ~ avg_3P_pct +
avg_FG_pct +
total_ft +
total_stl +
total_blk,
data = team_season)
summary(season_model)
# conduct elbow test to determine optimal number of means (k) for TEAM and GAME stats
#Scaling TEAMs by defensive AND offensive stats by
season_scaled <- scale(
team_season[, c( # "wins",
"avg_3P_pct",
"avg_FG_pct",
"total_ft",
"total_stl",
"total_blk")])
#summary(season_scaled)
# scaling GAMES stats by defensive AND offensive stats
team_game_scaled <- scale(
team_game[, c(   "3P_pct",
"FG_pct",
"FT",
"STL",
"BLK")])
# plot elbow plot of game stats
game_elb_test <- sapply(1:10, function(k){
kmeans(team_game_scaled, centers = k, nstart = 20)$tot.withinss
})
plot(1:10, game_elb_test, type = "b",
xlab = "Number of clusters (k)",
ylab = "Sum of Squares",
main = "Elbow Method for Game Stats")
# Plot shows k = 3 is the most optimal
# plot elbow test of team stats
season_elb_test <- sapply(1:10, function(k){
kmeans(season_scaled, centers = k, nstart = 20)$tot.withinss
})
plot(1:10, season_elb_test, type = "b",
xlab = "Number of clusters (k)",
ylab = "Sum of Squares",
main = "Elbow Method for Team Season Stats")
# Plot shows k = 3 is the most optimal
# add cluster column for teams and games
#summary(season_scaled)
kmeans_game_result <- kmeans(team_game_scaled, centers = 3)
team_game$cluster <- kmeans_game_result$cluster
kmeans_season_result <- kmeans(season_scaled, centers = 3)
team_season$cluster <- kmeans_season_result$cluster
# Plot of Team clusters
# Axis of the graph are the 2 most significant factors from model
plot(team_season$avg_FG_pct, team_season$total_stl,
col = team_season$cluster,
pch = 19,
xlab = "Average Feild Goal Percentage",
ylab = "Total Steals",
main = "Teams by Total Steals and Field Goal Percentage")
# Analyze what sets the team clusters apart
par(mfrow = c(1, 3)) # 1 row by 3 plots
colors <- c("red", "blue", "green")
# wins
boxplot(wins ~ cluster, data = team_season,
main = "Wins by Cluster",
xlab = "Cluster",
ylab = "Number of Wins",
col = colors)
# avg_FG_pct
boxplot(avg_FG_pct ~ cluster, data = team_season,
main = "FG% by Cluster",
xlab = "Cluster",
ylab = "Avg FG%",
col = colors)
# total_stl
boxplot(total_stl ~ cluster, data = team_season,
main = "Total Steals by Cluster",
xlab = "Cluster",
ylab = "Total Steals",
col = colors)
# plot of game stat clusters
plot(team_game$FG_pct, team_game$STL,
col = team_game$cluster,
pch = 19,
xlab = "FG%",
ylab = "Total Steals",
main = "Games plotted by FG% and Steals")
# Analyze what sets the GAME clusters apart
colors <- c("red", "blue", "green", "yellow")
# Barplot for wins and losses by cluster
# wins
ggplot(team_game, aes(x = factor(cluster), fill = Res)) +
geom_bar(position = "dodge") +
labs(title = "Wins and Losses by Cluster",
x = "Cluster",
y = "Count of Games",
fill = "Result")
# boxplot for FG% and STL by cluster
par(mfrow = c(1, 2)) # 1 row by 3 plots
# avg_FG_pct
boxplot(FG_pct ~ cluster, data = team_game,
main = "FG% by Cluster",
xlab = "Cluster",
ylab = "Avg FG%",
col = colors)
# total_stl
boxplot(STL ~ cluster, data = team_game,
main = "Steals by Cluster",
xlab = "Cluster",
ylab = "Total Steals",
col = colors)
# LOGISTIC REGRESSION MODEL
# Convert results to binary outcome: 1 = Win, 0 = Loss
team_game <- team_game %>%
mutate(win_binary = ifelse(Res == "W", 1, 0))
# Fit logistic regression predicting win/loss
logit_model <- glm(
win_binary ~ FG_pct + `3P_pct` + FT + STL + BLK + defensive_pressure + points,
data = team_game,
family = binomial
)
# Display model summary
summary(logit_model)
# GOODNESS OF FIT TESTS FOR LOGISTIC REGRESSION
#1. Likelihood Ratio Test (compare model vs null model)
null_model <- glm(win_binary ~ 1, data = team_game, family = binomial)
anova(null_model, logit_model, test = "Chisq")
#2. Hosmer–Lemeshow Test (requires ResourceSelection package)
hoslem.test(team_game$win_binary, fitted(logit_model), g = 10)
#3. Pseudo R-squared values (McFadden, Cox & Snell, Nagelkerke)
pR2(logit_model)
#5. ROC Curve and AUC
roc_obj <- roc(team_game$win_binary, pred_prob)
knitr::opts_chunk$set(echo = TRUE)
source("00_requirements.R")
search()
#Data Cleaning
raw_database_24_25 <- read_csv("database_24_25.csv")
head(raw_database_24_25)
# TEAM-GAME
team_game <- raw_database_24_25 %>%
group_by(Data, Tm, Opp, Res) %>%
summarise(
FG = sum(FG, na.rm = TRUE),
FGA = sum(FGA, na.rm = TRUE),
FG_pct = FG / FGA,
`3P` = sum(`3P`, na.rm = TRUE),
`3PA` = sum(`3PA`, na.rm = TRUE),
`3P_pct` = `3P` / `3PA`,
FT = sum(FT, na.rm = TRUE),
STL = sum(STL, na.rm = TRUE),
BLK = sum(BLK, na.rm = TRUE),
defensive_pressure = STL + BLK,
points = sum(PTS, na.rm = TRUE)
) %>%
ungroup()
head(team_game)
# TEAM-SEASON
team_season <- team_game %>%
group_by(Tm) %>%
summarise(
wins = sum(Res == "W"),
losses = sum(Res == "L"),
avg_FG_pct = mean(FG_pct, na.rm = TRUE),
avg_3P_pct = mean(`3P_pct`, na.rm = TRUE),
total_ft = sum(FT, na.rm = TRUE),
total_stl = sum(STL, na.rm = TRUE),
total_blk = sum(BLK, na.rm = TRUE),
avg_def_pressure = mean(defensive_pressure, na.rm = TRUE),
.groups = "drop"
)
team_season <- team_season %>% # order by who has the most wins
arrange(desc(wins))
head(team_season)
#Offensive Statistics
# Histogram: Field Goal Percentage (FG%)
ggplot(team_game, aes(x = FG_pct)) +
geom_histogram(bins = 30, fill = "skyblue", color = "black") +
labs(
title = "Distribution of Team Field Goal Percentage",
x = "Field Goal Percentage",
y = "Frequency"
) +
theme_minimal()
# Boxplot: Three-Point Percentage (3P%)
ggplot(team_game, aes(y = `3P_pct`)) +
geom_boxplot(fill = "skyblue", color = "black") +
labs(
title = "Boxplot of Team Three-Point Percentage",
y = "Three-Point Percentage"
) +
theme_minimal()
# Scatter Plot: Total Points Scored by Game
ggplot(team_game, aes(x = 1:nrow(team_game), y = points)) +
geom_point(color = "lightgreen", alpha = 0.7) +
labs(
title = "Total Points Scored by Game",
x = "Game Number",
y = "Points Scored"
) +
theme_minimal()
#Defensive Statistics
# Histogram: Total Steals Per Game
ggplot( team_game, aes(x = STL)) +
geom_histogram(bins = 30, fill = "purple", color = "black" ) +
labs(
title = "Distribution of Team Steals Per Game",
x = "Steals",
y = "Frequency"
) +
theme_minimal()
# Boxplot of Blocks by Game Outcome
ggplot(team_game, aes(x = Res, y = BLK, fill = Res)) +
geom_boxplot() +
labs(
title = "Blocks Per Game by Game Outcome",
x = "Game Result",
y = "Blocks"
) +
scale_fill_manual(values = c("W" = "lightblue", "L" = "salmon")) +
theme_minimal()
# Scatter Plot: Defensive Pressure by Game
ggplot(team_game, aes(x = 1:nrow(team_game), y = defensive_pressure)) +
geom_point(color = "lightcoral", alpha = 0.7) +
labs(
title = "Defensive Pressure (Steals + Blocks) by Game — 2024–25 NBA Season",
x = "Game Number",
y = "Defensive Pressure (STL + BLK)"
) +
theme_minimal()
# 3-Point Percentage (Offensive Efficiency)
# H0:There is no difference in the average 3-point shooting percentage (3P%) between games that teams win and games that teams lose.
# Ha: There is a difference in the average 3-point shooting percentage (3P%) between games that teams win and games that teams lose.
t_test_3p <- t.test(`3P_pct` ~ Res , data = team_game)
t_test_3p
# Defensive Pressure (Steals + Blocks)
# H0: There is no difference in the average defensive pressure (steals + blocks) between games that teams win and games that teams lose.
# Ha: There is a difference in the average defensive pressure (steals + blocks) between games that teams win and games that teams lose.
t_test_def <- t.test(defensive_pressure ~ Res, data = team_game)
t_test_def
set.seed(800) # keep clustering consistent
head(team_season)
# Create model to see which of the variables are most significant
# Notes on the model:
# R^2 with all 5: 0.6003
# R^2 after removing:
# avg_3P_pct 0.5732
# avg_FG_pct 0.4993 *
# total_ft 0.5986
# total_stl 0.4749 *
# total_blocks 0.5762
season_model <- lm(wins ~ avg_3P_pct +
avg_FG_pct +
total_ft +
total_stl +
total_blk,
data = team_season)
summary(season_model)
# conduct elbow test to determine optimal number of means (k) for TEAM and GAME stats
#Scaling TEAMs by defensive AND offensive stats by
season_scaled <- scale(
team_season[, c( # "wins",
"avg_3P_pct",
"avg_FG_pct",
"total_ft",
"total_stl",
"total_blk")])
#summary(season_scaled)
# scaling GAMES stats by defensive AND offensive stats
team_game_scaled <- scale(
team_game[, c(   "3P_pct",
"FG_pct",
"FT",
"STL",
"BLK")])
# plot elbow plot of game stats
game_elb_test <- sapply(1:10, function(k){
kmeans(team_game_scaled, centers = k, nstart = 20)$tot.withinss
})
plot(1:10, game_elb_test, type = "b",
xlab = "Number of clusters (k)",
ylab = "Sum of Squares",
main = "Elbow Method for Game Stats")
# Plot shows k = 3 is the most optimal
# plot elbow test of team stats
season_elb_test <- sapply(1:10, function(k){
kmeans(season_scaled, centers = k, nstart = 20)$tot.withinss
})
plot(1:10, season_elb_test, type = "b",
xlab = "Number of clusters (k)",
ylab = "Sum of Squares",
main = "Elbow Method for Team Season Stats")
# Plot shows k = 3 is the most optimal
# add cluster column for teams and games
#summary(season_scaled)
kmeans_game_result <- kmeans(team_game_scaled, centers = 3)
team_game$cluster <- kmeans_game_result$cluster
kmeans_season_result <- kmeans(season_scaled, centers = 3)
team_season$cluster <- kmeans_season_result$cluster
# Plot of Team clusters
# Axis of the graph are the 2 most significant factors from model
plot(team_season$avg_FG_pct, team_season$total_stl,
col = team_season$cluster,
pch = 19,
xlab = "Average Feild Goal Percentage",
ylab = "Total Steals",
main = "Teams by Total Steals and Field Goal Percentage")
# Analyze what sets the team clusters apart
par(mfrow = c(1, 3)) # 1 row by 3 plots
colors <- c("red", "blue", "green")
# wins
boxplot(wins ~ cluster, data = team_season,
main = "Wins by Cluster",
xlab = "Cluster",
ylab = "Number of Wins",
col = colors)
# avg_FG_pct
boxplot(avg_FG_pct ~ cluster, data = team_season,
main = "FG% by Cluster",
xlab = "Cluster",
ylab = "Avg FG%",
col = colors)
# total_stl
boxplot(total_stl ~ cluster, data = team_season,
main = "Total Steals by Cluster",
xlab = "Cluster",
ylab = "Total Steals",
col = colors)
# plot of game stat clusters
plot(team_game$FG_pct, team_game$STL,
col = team_game$cluster,
pch = 19,
xlab = "FG%",
ylab = "Total Steals",
main = "Games plotted by FG% and Steals")
# Analyze what sets the GAME clusters apart
colors <- c("red", "blue", "green", "yellow")
# Barplot for wins and losses by cluster
# wins
ggplot(team_game, aes(x = factor(cluster), fill = Res)) +
geom_bar(position = "dodge") +
labs(title = "Wins and Losses by Cluster",
x = "Cluster",
y = "Count of Games",
fill = "Result")
# boxplot for FG% and STL by cluster
par(mfrow = c(1, 2)) # 1 row by 3 plots
# avg_FG_pct
boxplot(FG_pct ~ cluster, data = team_game,
main = "FG% by Cluster",
xlab = "Cluster",
ylab = "Avg FG%",
col = colors)
# total_stl
boxplot(STL ~ cluster, data = team_game,
main = "Steals by Cluster",
xlab = "Cluster",
ylab = "Total Steals",
col = colors)
# LOGISTIC REGRESSION MODEL
# Convert results to binary outcome: 1 = Win, 0 = Loss
team_game <- team_game %>%
mutate(win_binary = ifelse(Res == "W", 1, 0))
# Fit logistic regression predicting win/loss
logit_model <- glm(
win_binary ~ FG_pct + `3P_pct` + FT + STL + BLK + defensive_pressure + points,
data = team_game,
family = binomial
)
# Display model summary
summary(logit_model)
# GOODNESS OF FIT TESTS FOR LOGISTIC REGRESSION
#1. Likelihood Ratio Test (compare model vs null model)
null_model <- glm(win_binary ~ 1, data = team_game, family = binomial)
anova(null_model, logit_model, test = "Chisq")
#2. Hosmer–Lemeshow Test (requires ResourceSelection package)
hoslem.test(team_game$win_binary, fitted(logit_model), g = 10)
#3. Pseudo R-squared values (McFadden, Cox & Snell, Nagelkerke)
pR2(logit_model)
# 4. Prediction from regression model
pred_prob <- predict(logit_model, type = "response")
pred_class <- ifelse(pred_prob > 0.5, 1, 0)
#5. ROC Curve and AUC
roc_obj <- roc(team_game$win_binary, pred_prob)
plot(roc_obj, main = "ROC Curve — Logistic Regression Model")
auc(roc_obj)
#6. Brier Score
brier_score <- mean((team_game$win_binary - pred_prob)^2)
brier_score
