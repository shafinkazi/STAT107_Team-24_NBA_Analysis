---
title: "STAT 107 Final Project: NBA Team Statistics and Winning"
author: "Team 24: Derek de Gracia, Shafin Kazi, Tiffany Huang, Tyler Wong"
date: "Due: 2025-12-05"
output:
  pdf_document: default
  html_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
source("00_requirements.R")
search()

```
Abstract:
Analytics and data-driven metrics have transformed modern NBA strategy, influencing roster decisions, offensive schemes, and defensive priorities. While many statistics are tracked in every game, not all contribute equally to winning. This study examines which team-level offensive and defensive statistics are most strongly associated with winning NBA games during the 2024–25 season.

Using cleaned box score data transformed into team aggregates, we evaluate the effect of shooting efficiency, three-point performance, free throws, defensive pressure (blocks + steals), and total points. We apply hypothesis testing, unsupervised clustering, and logistic regression to measure statistical significance, group team styles, and predict game outcomes. Results show that shooting efficiency (FG%) and defensive pressure are highly predictive of winning, while three-point accuracy contributes strongly but less consistently across teams. Logistic regression confirms that field-goal percentage and total points hold the highest predictive power with above-average classification accuracy.

This analysis provides insights useful to coaches, analysts, and scouting teams seeking to optimize roster construction and during-game strategy in the data-driven era of the NBA.

This report was made in conjunction with Derek De Gracia, Shafin Kazi, Tiffany Huang, Tyler Wong for STAT107 at UCR taught by Jose Sanchez Gomez. 
The repository is hosted by Github under https://github.com/shafinkazi/STAT107-NBA-Project

## 1. Introduction
The modern NBA is shaped heavily by analytics, efficiency, and data-driven decision-making. Teams increasingly rely on statistical insights to evaluate player performance, optimize game strategies, and gain competitive advantages. Among the many questions that arise in basketball analytics, one of the most fundamental is:

What statistical skills or attributes actually lead to winning games?

Although basketball is a team sport, game outcomes ultimately reflect patterns in offensive and defensive performance. Understanding which team-level statistics correlate most strongly with winning can benefit coaches, analysts, and front offices by highlighting which areas contribute most to success.

In this project, we analyze all team statistics from the 2024–25 NBA season to identify how offensive skills (such as 3-point shooting, assists, and field-goal efficiency) and defensive skills (such as steals, blocks, and turnovers) relate to game outcomes. By transforming player-level game logs into team-level summaries, we can compare performances across wins and losses and study which metrics are most predictive of success.

##Research Question
Which team-level offensive and defensive statistics are most strongly associated with winning NBA games in the 2024–25 season?

##To answer this question, we apply multiple statistical tools, including:
- Two-sample t-tests to compare offense vs. defense metrics between wins and losses
- K-means clustering to group team performance styles
- Logistic regression to predicti game outcomes from key features by turning the variables into binary conditions of win or lose

This multi-method approach allows us to evaluate individual statistical differences, build predictive models, and examine broader team-performance patterns.


## 2. Data
The data used for this analysis was sourced from Kaggle, a popular platform for data sharing that provides publicly available NBA teams' data in their playoffs. The dataset contains player-level box scores for NBA games during the 2024–25 season. Each row represents a single player's performance in one game and includes the offensive and defensive statistics used in our analysis:

Offensive metrics:
FG (field goals), FGA (field goal attempts), FG%, 3P (three-pointers made), 3PA (three-point attempts), 3P% (three-point percentage), AST (assists), and PTS (points).

Defensive metrics:
STL (steals), BLK (blocks), TOV (turnovers), DRB (defensive rebounds), and TRB (total rebounds).

The data-cleaning process begins by importing the raw player box scores from the 2024–25 NBA season using read_csv(), which loads the information into a structured data frame that can be inspected for accuracy with head(). Since each row initially represents a single player’s statistics from one game, the next step converts this information into meaningful team summaries. This is accomplished by grouping the data by game date, team, opponent, and game result, then aggregating all player statistics within each group. Using summarise(), field goals, three-pointers, free throws, steals, and blocks are summed with na.rm = TRUE, which removes missing values to prevent statistical distortion. Derived statistics such as field-goal and three-point percentages are calculated, and a new combined defensive metric, “defensive pressure,” is created by adding steals and blocks—capturing overall disruption on defense. After creating team-game totals, ungroup() ensures that no unintended grouping carries into later analysis. A similar transformation produces season-level summaries by grouping by team and counting total wins and losses while averaging shooting percentages and summing defensive metrics and free throws. This process not only cleans the dataset by handling missing values and reducing noisy player-level data, but also generates new performance indicators that represent team strength more accurately, preparing the dataset for statistical testing, clustering, and predictive modeling.

```{r}
#Data Cleaning 
raw_database_24_25 <- read_csv("database_24_25.csv")
head(raw_database_24_25)

```

```{r}
# TEAM-GAME

team_game <- raw_database_24_25 %>%
  group_by(Data, Tm, Opp, Res) %>%  
  summarise(
    FG = sum(FG, na.rm = TRUE),
    FGA = sum(FGA, na.rm = TRUE),
    FG_pct = FG / FGA,
    
    `3P` = sum(`3P`, na.rm = TRUE),
    `3PA` = sum(`3PA`, na.rm = TRUE),
    `3P_pct` = `3P` / `3PA`,
    
    FT = sum(FT, na.rm = TRUE),
    STL = sum(STL, na.rm = TRUE),
    BLK = sum(BLK, na.rm = TRUE),
    
    defensive_pressure = STL + BLK,
    points = sum(PTS, na.rm = TRUE)
  ) %>%
  ungroup()


```

```{r}
head(team_game)
```
```{r}
# TEAM-SEASON

team_season <- team_game %>%
  group_by(Tm) %>%
  summarise(
    wins = sum(Res == "W"),
    losses = sum(Res == "L"),
    avg_FG_pct = mean(FG_pct, na.rm = TRUE),
    avg_3P_pct = mean(`3P_pct`, na.rm = TRUE),
    total_ft = sum(FT, na.rm = TRUE),
    total_stl = sum(STL, na.rm = TRUE),
    total_blk = sum(BLK, na.rm = TRUE),
    avg_def_pressure = mean(defensive_pressure, na.rm = TRUE),
    .groups = "drop"
  )


```


## 3. Exploratory Data Analysis (Tyler)

```{r}
#Offensive Statistics
# Histogram: Field Goal Percentage (FG%)
ggplot(team_game, aes(x = FG_pct)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "black") +
  labs(
    title = "Distribution of Team Field Goal Percentage",
    x = "Field Goal Percentage",
    y = "Frequency"
  ) +
  theme_minimal()

```
```{r}
# Histogram: Three-Point Percentage (3P%)
ggplot(team_game, aes(x = `3P_pct`)) +
  geom_histogram(bins = 30, fill = "orange", color = "black") +
  labs(
    title = "Distribution of Team Three-Point Percentage",
    x = "Three-Point Percentage",
    y = "Frequency"
  ) +
  theme_minimal()

```

```{r}
# Histogram: Total Points Scored in game
ggplot(team_game, aes(x = points)) +
  geom_histogram(bins = 30, fill = "lightgreen", color = "black") +
   labs(
    title = "Distribution of Total Points Scored",
    x = "Points",
    y = "Frequency"
  ) +
  theme_minimal()
```
```{r}
# Defensive Statistics
# Histogram: Total Blocks Per Game
ggplot( team_game, aes(x = STL)) +
  geom_histogram(bins = 30, fill = "purple", color = "black" ) +
  labs(
    title = "Distribution of Team Steals Per Game",
    x = "Steals",
    y = "Frequency"
  ) +
  theme_minimal()
```


```{r}
# Histogram: Total Blocks Per Game
ggplot(team_game, aes(x = BLK)) +
  geom_histogram(bins = 30, fill = "lightblue", color = "black") +
  labs(
    title = "Distribution of Team Blocks Per Game",
    x = "Blocks",
    y = "Frequency"
  ) +
  theme_minimal()
```

```{r}
# Histogram: Defensive Pressure (Steals + Blocks)
ggplot(team_game, aes(x = defensive_pressure)) +
  geom_histogram(bins = 30, fill = "lightcoral", color = "black") +
  labs(
    title = "Distribution of Defensive Pressure (Steals + Blocks) — 2024–25 NBA Season",
    x = "Defensive Pressure (STL + BLK)",
    y = "Number of Games"
  ) +
  theme_minimal()

```
```{r}
## Exploratory Data Analysis write up
```{r}
# Offensive Statistics
The three offensive statistics show well NBA teams scored during the 2024-25 season. The field-goal percentage histogram shows that most teams shoot about the same, staying close to the league average. This means there aren’t huge variations in basic shooting skill from team to team. The three-point percentage histogram is more spread out, which shows that some teams are really good at shooting threes while others aren’t as strong. The points-scored histogram shows that most teams score around a normal amount, but a few teams score a lot more than everyone else. Overall, these offensive charts show that shooting threes and scoring lots of points are the biggest things that separate good offenses from average ones.

#Defensive Statistics
The defensive statistics show clear differences in how NBA teams slow down their opponents. In the defensive pressure histogram (steals + blocks), most teams usually get between 6 and 12 combined steals and blocks per game, but a smaller group of teams regularly got 15 or more, showing they play much more aggressive defense. The steals histogram shows that some teams are strong at forcing turnovers by grabbing 8–10 steals per game, while others stay closer to 4–6 steals, meaning they play a less risky style. For example, The Atlanta Hawks had a lot of steals because they had a player named Dyson Daniels who lead the league in steals because he was always being agressive and attacking the ball. The blocks histogram also shows big differences: teams with good rim protectors often reach 6 or more blocks, while others usually stay below 3. For example, a team like the Spurs got a lot of blocks because they have a player in Victor wembanyama who led the whole NBA in blocks last season. Overall, these defensive charts show that defensive performance has more variation than offense, and teams that produce a lot of steals and blocks stand out the most on that side of the game. 
```



## 4. T-Tests (Shafin)

```{r}
# 3-Point Percentage (Offensive Efficiency)

# H0:There is no difference in the average 3-point shooting percentage (3P%) between games that teams win and games that teams lose.
# Ha: There is a difference in the average 3-point shooting percentage (3P%) between games that teams win and games that teams lose.


t_test_3p <- t.test(`3P_pct` ~ Res , data = team_game)
t_test_3p

```
```{r}
# Defensive Pressure (Steals + Blocks)

# H0: There is no difference in the average defensive pressure (steals + blocks) between games that teams win and games that teams lose.
# Ha: There is a difference in the average defensive pressure (steals + blocks) between games that teams win and games that teams lose.

t_test_def <- t.test(defensive_pressure ~ Res, data = team_game)
t_test_def

```
## 5. K-Clustering (Derek)

```{r}
team_scaled <- scale(
  team_summary[, c("avg_3P_pct", 
                   "avg_FG_pct", 
                   "total_ft",
                   "total_stl", 
                   "total_blocks")])
#summary(team_scaled)
set.seed(800)
kmeans_result <- kmeans(team_scaled, centers = 3)

team_summary$cluster <- kmeans_result$cluster
```
```{r}
nba_model <- lm(wins ~ avg_3P_pct + avg_FG_pct + total_ft + 
                total_stl + total_blocks, data = team_summary)
summary(nba_model)

plot(team_summary$avg_3P_pct, team_summary$total_stl,
     col = team_summary$cluster,
     pch = 19,
     xlab = "Average 3 Pointer Percentage",
     ylab = "Total Steals",
     main = "3P% and Steals by Team Type")
```

## 6. Logistic Regression (Tiffany)

```{r}
#LOGISTIC REGRESSION MODEL

#Convert results to binary outcome: 1 = Win, 0 = Loss
team_game <- team_game %>%
  mutate(win_binary = ifelse(Res == "W", 1, 0))

# Fit logistic regression predicting win/loss
logit_model <- glm(
  win_binary ~ FG_pct + `3P_pct` + FT + STL + BLK + defensive_pressure + points,
  data = team_game,
  family = binomial
)

# Display model summary
summary(logit_model)
```
## 7. Goodness of Fit Tests (Tiffany)
```{r}
### GOODNESS OF FIT TESTS FOR LOGISTIC REGRESSION ###

# 1. Likelihood Ratio Test (compare model vs null model)
null_model <- glm(win_binary ~ 1, data = team_game, family = binomial)
anova(null_model, logit_model, test = "Chisq")

# 2. Hosmer–Lemeshow Test (requires ResourceSelection package)
if(!require(ResourceSelection)) install.packages("ResourceSelection")
library(ResourceSelection)

hoslem.test(team_game$win_binary, fitted(logit_model), g = 10)

# 3. Pseudo R-squared values (McFadden, Cox & Snell, Nagelkerke)
if(!require(pscl)) install.packages("pscl")
library(pscl)

pR2(logit_model)

# 4. Classification Accuracy and Confusion Matrix
pred_prob <- predict(logit_model, type = "response")
pred_class <- ifelse(pred_prob > 0.5, 1, 0)

conf_matrix <- table(
  Actual = team_game$win_binary,
  Predicted = pred_class
)
conf_matrix

accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)
accuracy

# 5. ROC Curve and AUC
if(!require(pROC)) install.packages("pROC")
library(pROC)

roc_obj <- roc(team_game$win_binary, pred_prob)
plot(roc_obj, main = "ROC Curve — Logistic Regression Model")
auc(roc_obj)

# 6. Brier Score
brier_score <- mean((team_game$win_binary - pred_prob)^2)
brier_score

```
